joms.jQuery.extend({createUploadIframe:function(d,b){var a="jUploadFrame"+d;if(window.ActiveXObject){var c=document.createElement('<iframe id="'+a+'" name="'+a+'" />');if(typeof b=="boolean"){c.src="javascript:false"}else{if(typeof b=="string"){c.src=b}}}else{var c=document.createElement("iframe");c.id=a;c.name=a}c.style.position="absolute";c.style.top="-1000px";c.style.left="-1000px";document.body.appendChild(c);return c},createUploadForm:function(g,b){var e="jUploadForm"+g;var a="jUploadFile"+g;var d=joms.jQuery('<form  action="" method="POST" name="'+e+'" id="'+e+'" enctype="multipart/form-data"></form>');var c=joms.jQuery("#"+b);var f=joms.jQuery(c).clone();joms.jQuery(c).attr("id",a);joms.jQuery(c).before(f);joms.jQuery(c).appendTo(d);joms.jQuery(d).css("position","absolute");joms.jQuery(d).css("top","-1200px");joms.jQuery(d).css("left","-1200px");joms.jQuery(d).appendTo("body");return d},ajaxFileUpload:function(k){k=joms.jQuery.extend({},joms.jQuery.ajaxSettings,k);var a=new Date().getTime();var b=joms.jQuery.createUploadForm(a,k.fileElementId);var i=joms.jQuery.createUploadIframe(a,k.secureuri);var h="jUploadFrame"+a;var j="jUploadForm"+a;if(k.global&&!joms.jQuery.active++){joms.jQuery.event.trigger("ajaxStart")}var c=false;var f={};if(k.global){joms.jQuery.event.trigger("ajaxSend",[f,k])}var d=function(l){var p=document.getElementById(h);try{if(p.contentWindow){f.responseText=p.contentWindow.document.body?p.contentWindow.document.body.innerHTML:null;f.responseXML=p.contentWindow.document.XMLDocument?p.contentWindow.document.XMLDocument:p.contentWindow.document}else{if(p.contentDocument){f.responseText=p.contentDocument.document.body?p.contentDocument.document.body.innerHTML:null;f.responseXML=p.contentDocument.document.XMLDocument?p.contentDocument.document.XMLDocument:p.contentDocument.document}}}catch(o){joms.jQuery.handleError(k,f,null,o)}if(f||l=="timeout"){c=true;var m;try{m=l!="timeout"?"success":"error";if(m!="error"){var n=joms.jQuery.uploadHttpData(f,k.dataType);if(k.success){k.success(n,m)}if(k.global){joms.jQuery.event.trigger("ajaxSuccess",[f,k])}}else{joms.jQuery.handleError(k,f,m)}}catch(o){m="error";joms.jQuery.handleError(k,f,m,o)}if(k.global){joms.jQuery.event.trigger("ajaxComplete",[f,k])}if(k.global&&!--joms.jQuery.active){joms.jQuery.event.trigger("ajaxStop")}if(k.complete){k.complete(f,m)}joms.jQuery(p).unbind();setTimeout(function(){try{joms.jQuery(p).remove();joms.jQuery(b).remove()}catch(q){joms.jQuery.handleError(k,f,null,q)}},100);f=null}};if(k.timeout>0){setTimeout(function(){if(!c){d("timeout")}},k.timeout)}try{var b=joms.jQuery("#"+j);joms.jQuery(b).attr("action",k.url);joms.jQuery(b).attr("method","POST");joms.jQuery(b).attr("target",h);if(b.encoding){b.encoding="multipart/form-data"}else{b.enctype="multipart/form-data"}joms.jQuery(b).submit()}catch(g){joms.jQuery.handleError(k,f,null,g)}if(window.attachEvent){document.getElementById(h).attachEvent("onload",d)}else{document.getElementById(h).addEventListener("load",d,false)}return{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(type=="script"){joms.jQuery.globalEval(data)}if(type=="json"){eval("data = "+data)}if(type=="html"){joms.jQuery("<div>").html(data).evalScripts()}return data}});joms.uploader={startIndex:0,postUrl:"",originalPostUrl:"",uploadText:"",addNewUpload:function(){this.startIndex+=1;var a=joms.jQuery("#photoupload").clone();a=joms.jQuery(a).attr("id","photoupload-"+this.startIndex).css("display","block");joms.jQuery("#photoupload-container").append(a);joms.jQuery("#photoupload-"+this.startIndex+" :file").attr("id","Filedata-"+this.startIndex);joms.jQuery("#photoupload-"+this.startIndex+" :file").attr("name","Filedata-"+this.startIndex);joms.jQuery("#photoupload-"+this.startIndex+" :input:hidden").attr("value",this.startIndex);joms.jQuery("#photoupload-"+this.startIndex+" .remove").bind("click",function(){joms.jQuery(this).parent().remove()})},startUpload:function(){var a=joms.jQuery("#photoupload").next().find(".elementIndex").val();joms.jQuery("#upload-photos-button").hide();joms.jQuery(".add-new-upload").hide();joms.jQuery("#photoupload-container input").filter(function(){return joms.jQuery(this).parent().css("display")=="block"}).attr("disabled",true);joms.uploader.upload(a)},upload:function(a){joms.jQuery("#Filedata-"+a).attr("disabled",false);if(joms.jQuery("#Filedata-"+a).val()==""){joms.jQuery("#photoupload-"+a).remove();joms.uploader.upload();if(joms.jQuery("#photoupload").next().length==0){joms.uploader.addNewUpload()}else{joms.jQuery("#photoupload-container input").filter(function(){return joms.jQuery(this).parent().css("display")=="block"}).attr("disabled",false)}joms.jQuery("#upload-photos-button").show();joms.jQuery("#new-upload-button").show();return}joms.uploader.postUrl=joms.uploader.originalPostUrl;var c=(joms.jQuery("#photoupload-"+a+" :input:checked").val()=="1")?"1":"0";this.postUrl=this.postUrl.replace("DEFAULT_PHOTOS",c);var b=joms.jQuery("#photoupload-"+a).next().find(".elementIndex").val();b=(b!="")?b:"undefined";this.postUrl=this.postUrl.replace("NXUP",b);joms.jQuery("#photoupload-"+a).children().each(function(){joms.jQuery(this).css("display","none")});joms.jQuery("#photoupload-"+a).append('<div id="photoupload-loading-'+a+'"><span class="loading" style="display:block;float: none;margin: 0px;"></span><span>'+joms.uploader.uploadText+"</span></div>");joms.jQuery.ajaxFileUpload({url:this.postUrl,secureuri:false,fileElementId:"Filedata-"+a,dataType:"json",success:function(e,d){joms.jQuery("#photoupload-loading-"+a).remove();if(typeof(e.error)!="undefined"&&e.error=="true"){joms.jQuery("#photoupload-"+a).css("background","#ffeded");joms.jQuery("#photoupload-"+a).append('<span class="error">'+e.msg+"</span>")}else{joms.jQuery("#photoupload-"+a).css("background","#edfff3");joms.jQuery("#photoupload-"+a).append('<span class="success">'+e.msg+"</span>");joms.jQuery("#community-photo-items").show();joms.jQuery(new Image()).attr("src",e.thumbUrl).appendTo("#community-photo-items div.container").wrap('<div class="photo-item" />')}joms.jQuery("#photoupload-"+a).fadeOut(4500,function(){joms.jQuery("#photoupload-"+a).remove();if(joms.jQuery("#photoupload").next().length==0){joms.uploader.addNewUpload()}});joms.jQuery("#photoupload-"+a+" .remove").css("display","block");if(e.nextupload!="undefined"){joms.uploader.upload(e.nextupload);return}else{joms.jQuery("#upload-photos-button").show();joms.jQuery("#new-upload-button").show()}},error:function(f,d,g){}});return false}};
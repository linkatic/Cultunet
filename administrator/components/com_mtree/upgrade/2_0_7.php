<?php
/**
 * @version		$Id: 2_0_7.php 575 2009-03-10 11:44:00Z CY $
 * @package		Mosets Tree
 * @copyright	(C) 2005-2009 Mosets Consulting. All rights reserved.
 * @license		GNU General Public License
 * @author		Lee Cher Yeong <mtree@mosets.com>
 * @url			http://www.mosets.com/tree/
 */

defined('_JEXEC') or die('Restricted access');

class mUpgrade_2_0_7 extends mUpgrade {
	function upgrade() {
		global $database;

		// Update corecreated class code
		$database->setQuery('UPDATE #__mt_fieldtypes SET ft_class = "class mFieldType_corecreated extends mFieldType_date {\r\n	var $name = \'link_created\';\r\n	var $numOfInputFields = 0;\r\n	function parseValue($value) {\r\n		return strip_tags($value);\r\n	}\r\n}"  WHERE field_type = "corecreated" LIMIT 1');
		$database->query();

		// Update corecreated version number
		$database->setQuery('UPDATE #__mt_fieldtypes_info SET ft_version = "2" WHERE ft_id = "22" LIMIT 1');
		$database->query();
		$this->printStatus( 'Updated corecreated field type to version 2.' );

		// Update coredesc class code
		$database->setQuery('UPDATE #__mt_fieldtypes SET ft_class = "class mFieldType_coredesc extends mFieldType {\r\n	var $name = \'link_desc\';\r\n	function parseValue($value) {\r\n		$params[\'stripAllTagsBeforeSave\'] = $this->getParam(\'stripAllTagsBeforeSave\',0);\r\n		$params[\'allowedTags\'] = $this->getParam(\'allowedTags\',\'u,b,i,a,ul,li,pre,br,blockquote\');\r\n		if($params[\'stripAllTagsBeforeSave\']) {\r\n			$value = $this->stripTags($value,$params[\'allowedTags\']);\r\n		}\r\n		return $value;		\r\n	}\r\n	function getInputHTML() {\r\n		global $mtconf;\r\n		\r\n		$inBackEnd = (substr(dirname($_SERVER[\'PHP_SELF\']),-13) == \'administrator\') ? true : false;\r\n		if( ($inBackEnd AND $mtconf->get(\'use_wysiwyg_editor_in_admin\')) || (!$inBackEnd AND $mtconf->get(\'use_wysiwyg_editor\')) ) {\r\n			ob_start();\r\n			editorArea( \'editor1\',  $this->getValue() , $this->getInputFieldName(1), \'100%\', $this->getSize(), \'75\', \'25\' );\r\n			$html = ob_get_contents();\r\n			ob_end_clean();\r\n		} else {\r\n			$html = \'<textarea class=\"inputbox\" name=\"\' . $this->getInputFieldName(1) . \'\" style=\"width:95%;height:\' . $this->getSize() . \'px\">\' . htmlspecialchars($this->getValue()) . \'</textarea>\';\r\n		}\r\n		return $html;\r\n	}\r\n	function getSearchHTML() {\r\n		return \'<input class=\"inputbox\" type=\"text\" name=\"\' . $this->getName() . \'\" size=\"30\" />\';\r\n	}\r\n	function getOutput($view=1) {\r\n		$params[\'parseUrl\'] = $this->getParam(\'parseUrl\',1);\r\n		$params[\'summaryChars\'] = $this->getParam(\'summaryChars\',255);\r\n		$params[\'stripSummaryTags\'] = $this->getParam(\'stripSummaryTags\',1);\r\n		$params[\'stripDetailsTags\'] = $this->getParam(\'stripDetailsTags\',1);\r\n		$params[\'parseMambots\'] = $this->getParam(\'parseMambots\',0);\r\n		$params[\'allowedTags\'] = $this->getParam(\'allowedTags\',\'u,b,i,a,ul,li,pre,br,blockquote\');\r\n		$params[\'showReadMore\'] = $this->getParam(\'showReadMore\',0);\r\n		$params[\'whenReadMore\'] = $this->getParam(\'whenReadMore\',0);\r\n		$params[\'txtReadMore\'] = $this->getParam(\'txtReadMore\',(( $GLOBALS[\'_VERSION\']->RELEASE == \'1.0\' )?_READ_MORE:JTEXT::_( \'Read More...\' )));\r\n		\r\n		$html = $this->getValue();\r\n		\r\n		// Details view\r\n		if($view == 1) {\r\n			global $mtconf;\r\n			if($params[\'stripDetailsTags\']) {\r\n				$html = $this->stripTags($html,$params[\'allowedTags\']);\r\n			}\r\n			if($params[\'parseUrl\'] AND $view == 0) {\r\n				$regex = \'/http:\\\\/\\\\/(.*?)(\\\\s|$)/i\';\r\n				$html = preg_replace_callback( $regex, array($this,\'linkcreator\'), $html );\r\n			}\r\n			if (!$mtconf->get(\'use_wysiwyg_editor\') && $params[\'stripDetailsTags\'] && !in_array(\'br\',explode(\',\',$params[\'allowedTags\'])) && !in_array(\'p\',explode(\',\',$params[\'allowedTags\'])) ) {\r\n				$html = nl2br(trim($html));\r\n			}\r\n			if($params[\'parseMambots\']) {\r\n				$this->parseMambots($html);\r\n			}\r\n		// Summary view\r\n		} else {\r\n			global $Itemid;\r\n			$html = preg_replace(\'@{[\\\\/\\\\!]*?[^<>]*?}@si\', \'\', $html);\r\n			if($params[\'stripSummaryTags\']) {\r\n				$html = strip_tags( $html );\r\n			}\r\n			if($params[\'summaryChars\'] > 0) {\r\n				$trimmed_desc = trim($this->html_substr($html,0,$params[\'summaryChars\']));\r\n			} else {\r\n				$trimmed_desc = \'\';\r\n			}\r\n			if ($this->strlen_utf8($html) > $params[\'summaryChars\']) {\r\n				$html = $trimmed_desc;\r\n				$html .= \' <b>...</b>\';\r\n			}\r\n			if( $params[\'showReadMore\'] && ($params[\'whenReadMore\'] == 1 || ($params[\'whenReadMore\'] == 0 && $this->strlen_utf8($html) > $params[\'summaryChars\'])) ) {\r\n				if(!empty($trimmed_desc)) {\r\n					$html .= \'<br />\';\r\n				}\r\n				$html .= \' <a href=\"\' . JRoute::_(\'index.php?option=com_mtree&task=viewlink&link_id=\' . $this->getLinkId() . \'&Itemid=\' . $Itemid) . \'\" class=\"readon\">\' . $params[\'txtReadMore\'] . \'</a>\';\r\n			}\r\n		}\r\n		return $html;\r\n	}\r\n}"  WHERE field_type = "coredesc" LIMIT 1');
		$database->query();

		// Update coredesc version number
		$database->setQuery('UPDATE #__mt_fieldtypes_info SET ft_version = "2" WHERE ft_id = "21" LIMIT 1');
		$database->query();
		$this->printStatus( 'Updated coredesc field type to version 2.' );

		// Update coremodified class code
		$database->setQuery('UPDATE #__mt_fieldtypes SET ft_class = "class mFieldType_coremodified extends mFieldType_date {\r\n	var $name = \'link_modified\';\r\n	var $numOfInputFields = 0;\r\n	function getOutput() {\r\n\r\n		$value = $this->getValue();\r\n		if($value == \'0000-00-00 00:00:00\') {\r\n			return $_MT_LANG->NEVER;\r\n		} else {\r\n			$dateFormat = $this->getParam(\'dateFormat\',\'%Y-%m-%d\');\r\n			return strftime($dateFormat,mktime(0,0,0,intval(substr($value,5,2)),intval(substr($value,8,2)),intval(substr($value,0,4))));\r\n		}\r\n	}\r\n\r\n}\r\n"  WHERE field_type = "coremodified" LIMIT 1');
		$database->query();

		// Update coremodified version number
		$database->setQuery('UPDATE #__mt_fieldtypes_info SET ft_version = "2" WHERE ft_id = "15" LIMIT 1');
		$database->query();
		$this->printStatus( 'Updated coremodified field type to version 2.' );

		// Update corewebsite class code
		$database->setQuery('UPDATE #__mt_fieldtypes SET ft_class = "class mFieldType_corewebsite extends mFieldType_weblink {\r\n	var $name = \'website\';\r\n\r\n	function getOutput() {\r\n		$maxUrlLength = $this->getParam(\'maxUrlLength\',60);\r\n		$text = $this->getParam(\'text\',\'\');\r\n		$openNewWindow = $this->getParam(\'openNewWindow\',1);\r\n		$useMTVisitRedirect = $this->getParam(\'useMTVisitRedirect\',1);\r\n	\r\n		$html = \'\';\r\n		$html .= \'<a href=\"\';\r\n		if($useMTVisitRedirect) {\r\n			global $Itemid;\r\n			$html .= JRoute::_(\'index.php?option=com_mtree&task=visit&link_id=\' . $this->getLinkId() . \'&Itemid=\' . $Itemid);\r\n		} else {\r\n			$html .= $this->getValue();\r\n		}\r\n		$html .= \'\"\';\r\n		if( $openNewWindow == 1 ) {\r\n			$html .= \' target=\"_blank\"\';\r\n		}\r\n		$html .= \'>\';\r\n		if(!empty($text)) {\r\n			$html .= $text;\r\n		} else {\r\n			$value = $this->getValue();\r\n			if(strpos($value,\'://\') !== false) {\r\n				$value = substr($value,(strpos($value,\'://\')+3));\r\n			}\r\n			if( empty($maxUrlLength) || $maxUrlLength == 0 ) {\r\n				$html .= $value;\r\n			} else {\r\n				$html .= substr($value,0,$maxUrlLength);\r\n				if( strlen($value) > $maxUrlLength ) {\r\n					$html .= $this->getParam(\'clippedSymbol\');\r\n				}\r\n			}\r\n		}\r\n		$html .= \'</a>\';\r\n		return $html;\r\n	}\r\n	\r\n	function getInputHTML() {\r\n\r\n		$showGo = $this->getParam(\'showGo\',1);\r\n		$showSpider = $this->getParam(\'showSpider\',0);\r\n		$inBackEnd = (substr(dirname($_SERVER[\'PHP_SELF\']),-13) == \'administrator\') ? true : false;\r\n		$html = \'\';\r\n		$html .= \'<input class=\"text_area inputbox\" type=\"text\" name=\"\' . $this->getInputFieldName(1) . \'\" id=\"\' . $this->getInputFieldName(1) . \'\" size=\"\' . $this->getSize() . \'\" value=\"\' . htmlspecialchars($this->getValue()) . \'\" />\';\r\n		if($showGo && $inBackEnd) {\r\n			$html .= \'&nbsp;\';\r\n			$html .= \'<input type=\"button\" class=\"button\" onclick=\\\\\'\';\r\n			$html .= \'javascript:window.open(\"index3.php?option=com_mtree&task=openurl&url=\"+escape(document.getElementById(\"website\").value))\\\\\'\';\r\n			$html .= \'value=\"\' . $_MT_LANG->GO . \'\" />\';\r\n		}\r\n		\r\n		if($showSpider && $inBackEnd) {\r\n			$html .= \'&nbsp;\';\r\n			$html .= \'<input type=\"button\" class=\"button\" onclick=\\\\\'\';\r\n			$html .= \'javascript: \';\r\n			$html .= \'jQuery(\"#spiderwebsite\").html(\"\' . $_MT_LANG->SPIDER_PROGRESS . \'\");\';\r\n			$html .= \'jQuery.ajax({\r\n			  type: \"POST\",\r\n			  url: mosConfig_live_site+\"/administrator/index2.php\",\r\n			  data: \"option=com_mtree&task=ajax&task2=spiderurl&url=\"+document.getElementById(\"website\").value+\"&no_html=1\",\r\n			  dataType: \"script\"\r\n			});\';\r\n			$html .= \'\\\\\'\';\r\n			$html .= \'value=\"\' . $_MT_LANG->SPIDER . \'\" />\';\r\n			$html .= \'<span id=\"spider\' . $this->getInputFieldName(1) . \'\" style=\"margin-left:5px;background-color:white\"></span>\';\r\n		}\r\n		return $html;\r\n	}\r\n	\r\n}"  WHERE field_type = "corewebsite" LIMIT 1');
		$database->query();

		// Update corewebsite version number
		$database->setQuery('UPDATE #__mt_fieldtypes_info SET ft_version = "2" WHERE ft_id = "11" LIMIT 1');
		$database->query();
		$this->printStatus( 'Updated corewebsite field type to version 2.' );

		// Update videoplayer class code
		$database->setQuery('UPDATE #__mt_fieldtypes SET ft_class = "class mFieldType_videoplayer extends mFieldType_file {\r\n\r\n	function getOutput() {\r\n		$html =\'\';\r\n		$filename = $this->getValue();\r\n		$format = $this->getParam(\'format\');\r\n		$id = $format.$filename;\r\n		$width = $this->getParam(\'width\');\r\n		$height = $this->getParam(\'height\');\r\n		$autoplay = $this->getParam(\'autoplay\',false);\r\n		\r\n		switch($format) {\r\n			case \'mov\':\r\n				$html .= \'<object classid=\"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B\" width=\"\' . $width . \'\" height=\"\' . $height. \'\" codebase=\"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0\" align=\"middle\">\';\r\n				$html .= \'<param name=\"src\" value=\"\' . $this->getDataAttachmentURL() . \'\" />\';\r\n				$html .= \'<param name=\"autoplay\" value=\"\' . $autoplay . \'\" />\';\r\n				$html .= \'<embed src=\"\' . $this->getDataAttachmentURL() . \'\" type=\"video/quicktime\" width=\"\' . $width . \'\" height=\"\' . $height . \'\" pluginspage=\"http://www.apple.com/quicktime/download/\" align=\"middle\" autoplay=\"\' . $autoplay . \'\" />\';\r\n				$html .= \'</object>\';\r\n				break;\r\n			case \'divx\':\r\n				$html .= \'\';\r\n				$html .= \'<object classid=\"clsid:67DABFBF-D0AB-41fa-9C46-CC0F21721616\" width=\"\' . $width . \'\" height=\"\' . $height . \'\" codebase=\"http://go.divx.com/plugin/DivXBrowserPlugin.cab\">\';\r\n				$html .= \'<param name=\"src\" value=\"\' . $this->getDataAttachmentURL() . \'\" />\';\r\n				$html .= \'<param name=\"autoPlay\" value=\"\' . $autoplay . \'\" />\';\r\n				$html .= \'<embed src=\"\' . $this->getDataAttachmentURL() . \'\" type=\"video/divx\" width=\"\' . $width . \'\" height=\"\' . $height . \'\" autoPlay=\"\' . $autoplay . \'\" pluginspage=\"http://go.divx.com/plugin/download/\" />\';\r\n				$html .= \'</object>\';\r\n				break;\r\n			case \'windowsmedia\':\r\n				$html .= \'<object classid=\"CLSID:6BF52A52-394A-11D3-B153-00C04F79FAA6\" id=\"\' . $id . \'\" width=\"\' . $width . \'\" height=\"\' . $height . \'\" type=\"application/x-oleobject\">\';\r\n				$html .= \'<param name=\"URL\" value=\"\' . $this->getDataAttachmentURL() . \'\" />\';\r\n				$html .= \'<param name=\"wmode\" value=\"opaque\" />\';\r\n				$html .= \'<param name=\"ShowControls\" value=\"1\" />\';\r\n				$html .= \'<param name=\"autoStart\" value=\"\' . (($autoplay)?\'1\':\'0\') . \'\" />\';\r\n				$html .= \'<embed src=\"\' . $this->getDataAttachmentURL() . \'\" type=\"application/x-mplayer2\" width=\"\' . $width . \'\" height=\"\' . $height . \'\" wmode=\"opaque\" border=\"0\" autoStart=\"\' . (($autoplay)?\'1\':\'0\') . \'\" />\';\r\n				$html .= \'</object>\';\r\n				break;\r\n		}\r\n		return $html;\r\n	}\r\n}"  WHERE field_type = "videoplayer" LIMIT 1');
		$database->query();

		// Update videoplayer version number
		$database->setQuery('UPDATE #__mt_fieldtypes_info SET ft_version = "2" WHERE ft_id = "45" LIMIT 1');
		$database->query();
		$this->printStatus( 'Updated videoplayer field type to version 2.' );

		// Update videoplayer params.xml
		$database->setQuery("UPDATE #__mt_fieldtypes_att SET filedata = 0x3C6D6F73706172616D7320747970653D226D6F64756C65223E0A093C706172616D733E0A09093C706172616D206E616D653D22666F726D61742220747970653D226C697374222064656661756C743D2222206C6162656C3D22566964656F20466F726D6174223E0A0909093C6F7074696F6E2076616C75653D226D6F76223E517569636B74696D65204D6F7669653C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2264697678223E446976583C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2277696E646F77736D65646961223E57696E646F7773204D6564696120566964656F3C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D2277696474682220747970653D2274657874222064656661756C743D2222206C6162656C3D22576964746822202F3E0A09093C706172616D206E616D653D226865696768742220747970653D2274657874222064656661756C743D2222206C6162656C3D2268656967687422202F3E0A09093C706172616D206E616D653D226175746F706C61792220747970653D22726164696F222064656661756C743D2266616C736522206C6162656C3D224175746F20506C6179223E0A0909093C6F7074696F6E2076616C75653D2274727565223E5965733C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2266616C7365223E4E6F3C2F6F7074696F6E3E0A09093C2F706172616D3E0A09090A093C2F706172616D733E0A3C2F6D6F73706172616D733E, filesize = 572 WHERE ft_id = 45 AND filename = 'params.xml' LIMIT 1");
		$database->query();

		// Update coredesc params.xml
		$database->setQuery("UPDATE #__mt_fieldtypes_att SET filedata = 0x3C6D6F73706172616D7320747970653D226D6F64756C65223E0A093C706172616D733E0A09093C706172616D206E616D653D2273756D6D61727943686172732220747970653D2274657874222064656661756C743D2232353522206C6162656C3D224E756D626572206F662053756D6D617279206368617261637465727322202F3E0A09093C706172616D206E616D653D22737472697053756D6D617279546167732220747970653D22726164696F222064656661756C743D223122206C6162656C3D22537472697020616C6C2048544D4C207461677320696E2053756D6D617279207669657722206465736372697074696F6E3D2253657474696E67207468697320746F207965732077696C6C2072656D6F766520616C6C2074616773207468617420636F756C6420706F74656E7469616C6C7920616666656374207768656E2076696577696E672061206C697374206F66206C697374696E67732E223E0A0909093C6F7074696F6E2076616C75653D2230223E4E6F3C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E5965733C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D22737472697044657461696C73546167732220747970653D22726164696F222064656661756C743D223122206C6162656C3D22537472697020616C6C2048544D4C207461677320696E2044657461696C73207669657722206465736372697074696F6E3D2253657474696E67207468697320746F207965732077696C6C2072656D6F766520616C6C2074616773206578636570742074686F73652074686174206172652073706563696669656420696E2027416C6C6F7765642074616773272E223E0A0909093C6F7074696F6E2076616C75653D2230223E4E6F3C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E5965733C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D22706172736555726C2220747970653D22726164696F222064656661756C743D223122206C6162656C3D2250617273652055524C206173206C696E6B20696E2044657461696C732076696577223E0A0909093C6F7074696F6E2076616C75653D2230223E4E6F3C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E5965733C2F6F7074696F6E3E0A09093C2F706172616D3E0A0A09093C706172616D206E616D653D227374726970416C6C546167734265666F7265536176652220747970653D22726164696F222064656661756C743D223022206C6162656C3D22537472697020616C6C2048544D4C2074616773206265666F72652073746F72696E6720746F20646174616261736522206465736372697074696F6E3D224966205759535957494720656469746F7220697320656E61626C656420696E207468652066726F6E742D656E642C2074686973206665617475726520616C6C6F7720796F7520746F20737472697020616E7920706F74656E7469616C6C79206861726D66756C20636F6465732E20596F752063616E207374696C6C20616C6C6F7720736F6D6520746167732077697468696E206465736372697074696F6E206669656C642C2077686963682063616E206265207370656369666965642062656C6F772E223E0A0909093C6F7074696F6E2076616C75653D2230223E4E6F3C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E5965733C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D22616C6C6F776564546167732220747970653D2274657874222064656661756C743D22752C622C692C612C756C2C6C692C7072652C626C6F636B71756F746522206C6162656C3D22416C6C6F776564207461677322206465736372697074696F6E3D22456E7465722074686520746167206E616D65732073657065726174656420627920636F6D6D612E205468697320706172616D6574657220616C6C6F7720796F7520746F2061636365707420736F6D652048544D4C2074616773206576656E20696620796F75206861766520656E61626C65207374726970696E67206F6620616C6C2048544D4C20746167732061626F76652E22202F3E0A09093C706172616D206E616D653D2270617273654D616D626F74732220747970653D22726164696F222064656661756C743D223022206C6162656C3D225061727365204D616D626F747322206465736372697074696F6E3D22456E61626C696E6720746869732077696C6C207061727365206D616D626F747320636F646573732077697468696E20746865206465736372697074696F6E206669656C64223E0A0909093C6F7074696F6E2076616C75653D2230223E4E6F3C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E5965733C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D2273686F77526561644D6F72652220747970653D22726164696F222064656661756C743D223022206C6162656C3D2253686F77202671756F743B52656164204D6F72652E2E2E2671756F743B22206465736372697074696F6E3D2253686F77202671756F743B52656164204D6F72652E2E2671756F743B2069662061206465736372697074696F6E207465787420636C697070656420696E2053756D6D61727920566965772E223E0A0909093C6F7074696F6E2076616C75653D2230223E4E6F3C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E5965733C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D227768656E526561644D6F72652220747970653D226C697374222064656661756C743D223022206C6162656C3D225768656E20746F2073686F77202671756F743B52656164204D6F72652E2E2671756F743B22206465736372697074696F6E3D225468697320616C6C6F7720796F7520746F20736574207768656E20746F2073686F7720746865202671756F743B52656164204D6F72652E2E2671756F743B206C696E6B2E223E0A0909093C6F7074696F6E2076616C75653D2230223E4F6E6C79207768656E206465736372697074696F6E20697320636C697070656420696E2053756D6D61727920566965773C2F6F7074696F6E3E0A0909093C6F7074696F6E2076616C75653D2231223E416C6C207468652074696D653C2F6F7074696F6E3E0A09093C2F706172616D3E0A09093C706172616D206E616D653D22747874526561644D6F72652220747970653D2274657874222064656661756C743D2252656164204D6F72652E2E2E22206C6162656C3D2252656164204D6F7265207465787422206465736372697074696F6E3D22456E74657220746865202671756F743B52656164204D6F72652E2E2671756F743B20746578742E22202F3E0A093C2F706172616D733E0A3C2F6D6F73706172616D733E, filesize = 2541 WHERE ft_id = 21 AND filename = 'params.xml' LIMIT 1");
		$database->query();

		// Update corecreated params.xml
		$database->setQuery("UPDATE #__mt_fieldtypes_att SET filedata = 0x3C6D6F73706172616D7320747970653D226D6F64756C65223E0D0A093C706172616D733E0D0A09093C706172616D206E616D653D227374617274596561722220747970653D2274657874222064656661756C743D2222206C6162656C3D225374617274207965617222206465736372697074696F6E3D22456E74657220746865207374617274696E672079656172206F72206561726C69657374207965617220617661696C61626C6520666F722073656C656374696F6E2E204966206C65667420656D7074792C2069742077696C6C2064656661756C7420746F2037302079656172732061676F2066726F6D207468652063757272656E7420796561722E22202F3E0D0A09093C706172616D206E616D653D22656E64596561722220747970653D2274657874222064656661756C743D2222206C6162656C3D22456E64207965617222206465736372697074696F6E3D22456E74657220746865206C61746573742079656172206F7220617661696C61626C6520666F722073656C656374696F6E2E204966206C65667420656D7074792C207468652063757272656E7420796561722077696C6C20626520757365642E22202F3E0D0A09093C706172616D206E616D653D2264617465466F726D61742220747970653D226C697374222064656661756C743D2222206C6162656C3D224461746520466F726D617422203E0D0A0909093C6F7074696F6E2076616C75653D2225592D256D2D2564223E323030372D30362D30313C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D2225652E256D2E2559223E312E30362E323030373C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D222565202542202559223E31204A756E6520323030373C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D2225652F256D2F2559223E312F30362F323030373C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D22256D2F25652F2559223E30362F312F323030373C2F6F7074696F6E3E0D0A09093C2F706172616D3E09090D0A093C2F706172616D733E0D0A3C2F6D6F73706172616D733E, filesize = 792 WHERE ft_id = 22 AND filename = 'params.xml' LIMIT 1");
		$database->query();

		// Update coremodified params.xml
		$database->setQuery("UPDATE #__mt_fieldtypes_att SET filedata = 0x3C6D6F73706172616D7320747970653D226D6F64756C65223E0D0A093C706172616D733E0D0A09093C706172616D206E616D653D227374617274596561722220747970653D2274657874222064656661756C743D2222206C6162656C3D225374617274207965617222206465736372697074696F6E3D22456E74657220746865207374617274696E672079656172206F72206561726C69657374207965617220617661696C61626C6520666F722073656C656374696F6E2E204966206C65667420656D7074792C2069742077696C6C2064656661756C7420746F2037302079656172732061676F2066726F6D207468652063757272656E7420796561722E22202F3E0D0A09093C706172616D206E616D653D22656E64596561722220747970653D2274657874222064656661756C743D2222206C6162656C3D22456E64207965617222206465736372697074696F6E3D22456E74657220746865206C61746573742079656172206F7220617661696C61626C6520666F722073656C656374696F6E2E204966206C65667420656D7074792C207468652063757272656E7420796561722077696C6C20626520757365642E22202F3E0D0A09093C706172616D206E616D653D2264617465466F726D61742220747970653D226C697374222064656661756C743D2222206C6162656C3D224461746520466F726D617422203E0D0A0909093C6F7074696F6E2076616C75653D2225592D256D2D2564223E323030372D30362D30313C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D2225652E256D2E2559223E312E30362E323030373C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D222565202542202559223E31204A756E6520323030373C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D2225652F256D2F2559223E312F30362F323030373C2F6F7074696F6E3E0D0A0909093C6F7074696F6E2076616C75653D22256D2F25652F2559223E30362F312F323030373C2F6F7074696F6E3E0D0A09093C2F706172616D3E09090D0A093C2F706172616D733E0D0A3C2F6D6F73706172616D733E, filesize = 792 WHERE ft_id = 15 AND filename = 'params.xml' LIMIT 1");
		$database->query();

		updateVersion(2,0,7);
		$this->updated = true;
		return true;
	}
}
?>